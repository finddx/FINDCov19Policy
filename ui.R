banner <- tags$section(class = "hero",
  tags$span(class = "gradient",
    tags$div(class = "content",
      tags$div(style = "display: flex; align-items: center;",
        tags$h2(class = "subtitle underline", "COVID-19 Diagnostics Policy and Therapeutics Access Dashboard")
      )
    )
  )
)

tabset_panel <- shiny::tabsetPanel(id = "id",
  shiny::tabPanel(title = "Diagnostics", value = "testing_rates",
    fluidRow(
      # put everything in a huge tablerCard, to ensure nice borders
      tags$div(class = "col-md-12", style = "margin: 0 -1.75rem;",
        tags$div(class = "card ",
          tags$div(class = "card-body",
            dx_section_about(),
            mod_map_ui(id = "mod_map_diagnostic", 
                       title = "Tests used and registered in the countries",
                       categories = c("Molecular Test", "Antibody RDT", "Professional Use Antigen RDT", "Self-test Antigen RDT"),
                       category_help_text = "Please select to display whether Molecular/Antigen/Antibody testing is registered for use in countries"),
            mod_policy_table_ui(id = "mod_table_diagnostic", title = "Diagnostics Policy Table",
                                column_choices = dx_column_choices, default_cols = dx_default_cols, last_update_date = "2022-08-31"),
            dx_section_contact()
          )
        )
      )
    )
  ),
  shiny::tabPanel(title = "Therapeutics", value = "testing_rates",
    fluidRow(
      tags$div(class = "col-md-12", style = "margin: 0 -1.75rem;",
        tags$div(class = "card ",
          tags$div(class = "card-body",
            tx_section_about(),
            mod_map_ui(id = "mod_map_treatment",
                       title = "Therapeutics available in the countries",
                       categories = c("Nirmatrelvir/Ritonavir", "Molnupiravir"),
                       category_help_text = "Please select to display if countries are eligible to access nirmatrelvir/ritonavir or molnupiravir from ACT-A partners and/or are included in MPPâ€™s Voluntary License territory"),
            mod_policy_table_ui(id = "mod_table_treatment", title = "Treatment Access Table",
                                column_choices = tx_column_choices, default_cols = tx_default_cols, last_update_date = "2023-02-22"),
            tx_section_contact()
          )
        )
      )
    )
  )
)

for (i in 1:2) {
  tabset_panel$children[[1]]$children[[i]]$children[[1]] <- htmltools::tagAppendAttributes(
    tabset_panel$children[[1]]$children[[i]]$children[[1]],
    class = if (i == 1) "menu-app active" else "menu-app"
  )
}

tablerDashPage(
  navbar = tags$div(
    banner
  ),
  footer = tablerDashFooter(tagList("COVID-19 Diagnostics Policy and Therapeutics Access Dashboard"), copyrights = "Copyright FIND"),
  title = "Country testing policies",
  body = tablerDashBody(
    # HTML / CSS / JS dependencies
    load_html_dependencies(),
    
    tabset_panel
  )
)
